<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="volver()">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Mantenimientos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div *ngIf="moto" class="moto-resumen">
    <h2>{{ moto.marca }} {{ moto.modelo }}</h2>
    <p>Año {{ moto.anio }} · Km inicial: {{ moto.kmInicial | number:'1.0-0' }}</p>
  </div>

  <!-- Lista de mantenimientos -->
  <div *ngIf="lista.length > 0; else sinMantenimientos">
    <div *ngFor="let m of lista" class="mant-item">
      <h3>{{ m.tipo }}</h3>
      <p>Fecha: {{ m.fecha }} · Km: {{ m.km | number:'1.0-0' }}</p>
      <p *ngIf="m.costo">Costo: {{ m.costo | currency:'CLP' }}</p>
      <p *ngIf="m.notas">{{ m.notas }}</p>
      <p *ngIf="m.sellado">
        ✅ Sellado por: {{ m.selladoPor }}
      </p>
      <button type="button" (click)="onEliminar(m)">Eliminar</button>
    </div>
  </div>

  <ng-template #sinMantenimientos>
    <p class="empty">No hay mantenimientos registrados para esta motocicleta.</p>
  </ng-template>

  <!-- Formulario para agregar mantenimiento -->
  <div class="form-card">
    <h3>Registrar mantenimiento</h3>

    <form (ngSubmit)="onAgregar()">

      <div class="form-group">
        <label for="tipo">Tipo de servicio</label>
        <select
          id="tipo"
          name="tipo"
          [(ngModel)]="form.tipo"
          required
        >
          <option *ngFor="let t of tiposServicios" [ngValue]="t">
            {{ t }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="fecha">Fecha</label>
        <input
          id="fecha"
          type="date"
          name="fecha"
          [(ngModel)]="form.fecha"
          required
        />
      </div>

      <div class="form-group">
        <label for="km">Kilometraje (km)</label>
        <input
          id="km"
          type="number"
          name="km"
          [(ngModel)]="form.km"
          required
        />
      </div>

      <div class="form-group">
        <label for="costo">Costo (CLP)</label>
        <input
          id="costo"
          type="number"
          name="costo"
          [(ngModel)]="form.costo"
        />
      </div>

      <div class="form-group">
        <label for="notas">Notas</label>
        <textarea
          id="notas"
          name="notas"
          [(ngModel)]="form.notas"
          rows="3"
        ></textarea>
      </div>

      <button type="submit" class="btn-primary">
        Guardar mantenimiento
      </button>
    </form>
  </div>

</ion-content>
